С_И_С_Т_Е_М_А  У_П_Р_А_В_Л_Е_Н_И_Я  Ф_А_Й_Л_О_В_Ы_М  П_Р_Е_Д_С_Т_А_В_Л_Е_Н_И_Е_М  Ф_О_Т_О_Г_Р_А_Ф_И_Й


Версия: 0.0.0^


————————————————


П Р И Ч И Н Ы


В среде управляющих цифровых систем, основанных на неповторимости имён файлов, возникает необходимость:
1. в устранении вероятности появления файлов фотографий с одинаковыми именами, т. к. в этих случаях возникает угроза их потери из-за перезаписи;
2. в устранении несовместимости систем хранения отдельных подмножеств файлового представления фотографий, т. к. в этих случаях снижается удобство их совместного обслуживания и увеличиваются затраты времени и труда.


Н А П Р А В Л Е Н И Е  Р Е Ш Е Н И Я


Создание единой системы хранения файлового представления фотографий, которая полностью или в достаточной степени исключает возникновение одноимённых файлов.


Т Р Е Б О В А Н И Я  К  Р Е Ш Е Н И Ю


Решение должно стремиться к наибольшей свободе для условий создания, использования и обслуживания файлового представления фотографий.


Р Е Ш Е Н И Е


ОБЩИЕ ПОЛОЖЕНИЯ


• Условия съёмки предполагаются желательно в пределах одного часового пояса на планете Земля.
• За основу файлового представления фотографии принимается её raw-файл.
• Програмным инструментом для решения является приложение ExifTool

https://owl.phy.queensu.ca/~phil/exiftool

от Фила Харви (Phil Harvey).
• Примеры команд отражают лишь частный случай и для изменения их под свои условия и предпочтения с сохранением сути предполагают по крайней мере начальный уровень понимания ExifTool и Perl-совместимых регулярных выражений.
• Все файлы в пределах одной сессии их именования и распределения предполагаются абсолютно подходящими для используемых ExifTool-команд.
• Из-за разнообразия состава и содержимого метаданных от разных производителей предполагается возможная необходимость приспособления системы для отдельных камер.
• Все raw-файлы имеют полноценное количество достоверных первоначальных метаданных.
• Правила не строгие и только основа, при необходимости или желании допустимы отступления под собственную ответственность пользователя.
• Должна быть промежуточная папка для сбора raw-файлов перед их упорядочиванием и использованием:

НОСИТЕЛЬ\ПРОМЕЖУТОЧНАЯ_ПАПКА\

• Структура папок и файлов должна быть в корне носителя.
Это необходимо для уменьшения длинны полного имени файлов; например, Windows позволяет максимум 260 символов для полного имени.
• Используются только латиница и некоторые другие символы:

a-Z, 0-9, _

Это позволяет максимально упростить использование имён файлов в скриптах и позволяет сделать имена файлов единообразными, что повышает удобство их визуального восприятия независимо от того, где, кем и когда они были созданы.

• Названия и иерархия папок основываются на хронологии снимков, т. к. она более чем другие параметры предрасположена к однозначности и наглядности совместно:

НОСИТЕЛЬ\ГГГГ\ГГГГММДД\СНИМОК

• Для создания имён raw-файлов используются только следующие, способные быть известными для съёмки, метаданные, которые выбраны из-за их постоянности и в совокупности достаточны для относительной глобальной уникальности:

20190718 — дата.
032000 — время.
f0300 или b0230 — часовой пояс (f — forward (вперёд), b — backward (назад)). Задаётся вручную, если он не прописан в метаданные камерой автоматически.
CanonEOS5DMarkIV — модель камеры (этим можно пренебречь и использовать только серийный номер камеры, вероятность совпадения которого с серийными номерами от других производителей ничтожна).
ZA2561817 — внутренний серийный номер или серийный номер камеры (желательно выбрать тот, который из них короче).
IMG_0024 — первое название снимка (возможно, вам придётся добавить его самостоятельно, но некоторые камеры пишут что-то подобное в метаданных, например, FileNumber:100-0024 в IMG_0024.cr2).
v02 — версия результата для производных от raw-файлов (v — version (версия)).
 
• Некоторые камеры не записывают некоторые метаданные, например, часовой пояс, тогда эти метаданные для сохранения придётся добавлять самостоятельно.


ПОРЯДОК ДЕЙСТВИЙ


• Сбор raw-файлов в промежуточной папке, желательно в её корне.
• Удаление ненужных raw-файлов.
• Занесение в метаданные raw-файлов информации об авторских правах на фотографии.

exiftool -progress: -progress -r -EXIF:Artist="Author Name" -EXIF:Copyright="Author Name" -IPTC:By-Line="Author Name" -IPTC:CopyrightNotice="Author Name" -XMP:Creator="Author Name" -XMP:Rights="Author Name" -ext cr2 .

• Занесение исходного названия raw-файлов в их метаданные.

exiftool -progress: -progress -r "-IPTC:ObjectName<Filename" "-XMP:PreservedFileName<Filename" "-XMP:CameraFilename<Filename" "-XMP:OriginalFileName<Filename" "-XMP:RawFileName<Filename" -ext cr2 .

• Если в метаданных отсутствует информация о часовом поясе, то его добавление делается вручную.

exiftool -progress: -progress -r -EXIF:OffsetTime="+03:00" -EXIF:OffsetTimeOriginal="+03:00" -EXIF:OffsetTimeDigitized="+03:00" -ext cr2 .

• Распределение с переименованием оставшихся raw-файлов по структуре папок.

exiftool -progress: -progress -r -d "%Y/%Y%m%d/%Y%m%d_%H%M%S" "-FileName<D:\${DateTimeOriginal}_${OffsetTimeOriginal;s/\+/f/;s/-/b/;s/://}_${Model;s/ //g}_${InternalSerialNumber}_${FileName}" -ext cr2 .

…D:\… — буква диска задаётся вручную.

• Создание производных от raw-файлов (производные создаются в той же папке, что и raw-файлы, а также получают уточнённое имя при необходимости, например, с добавлением версии).


П Р И М Е Р Ы


ПОЛНОЕ СООТВЕТСТВИЕ СИСТЕМЕ


D:\2019\20190718\…:
• …20190718_032000_f0300_CanonEOS5DMarkIV_ZA2561817_IMG_0024.cr2
• …20190718_032000_f0300_CanonEOS5DMarkIV_ZA2561817_IMG_0024.psd
• …20190718_032000_f0300_CanonEOS5DMarkIV_ZA2561817_IMG_0024_v02.psd
• …20190718_032000_f0300_CanonEOS5DMarkIV_ZA2561817_IMG_0024.jpg
• …20190718_032000_f0300_CanonEOS5DMarkIV_ZA2561817_IMG_0024_v02.jpg


ПОЛЬЗОВАТЕЛЬСКИЕ ОТСТУПЛЕНИЯ


• D:\2019\20190718\20190718_032000_f0300_ZA2561817_IMG_0024.cr2
• D:\2019\20190718\20190718_032000_f0300_ZA2561817_IMG_0024_v02.jpg
• D:\2019\20190718_Minsk\20190718_032000_f0300_CanonEOS5DMarkIVZA2561817IMG0024.cr2
• D:\2019\20190718_Photography_workshop\20190718032000_f0300ZA2561817IMG0024.cr2
• D:\2019\20190718\20190718_032000f0300_IMG0024.cr2
• D:\2019\20190718\20190718_IMG0024.cr2 (это один из вариантов с низкой уникальностью названия, который не рекомендуется)


————————————————


Свёрстано по Текстазису — textasis.afoteris.com.
© Андрей Коржиц, Елена Абражевич, 2019–∞
gmail: andreikorzhyts